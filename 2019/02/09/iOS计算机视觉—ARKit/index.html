<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ios," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="ARKit介绍AR 全称 Augmented Reality(增强现实)是一种在视觉上呈现虚拟物体与现实场景结合的技术。Apple 公司在 2017 年 6 月正式推出了 ARKit，iOS 开发者可以在这个平台上使用简单便捷的 API 来开发 AR 应用程序。为了获得 ARKit 的完整功能，需要 A9 及以上芯片。其实也就是大部分运行 iOS 11 的设备，包括 iPhone 6S。  研究">
<meta name="keywords" content="ios">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS计算机视觉—ARKit">
<meta property="og:url" content="http://jackyshan.github.io/2019/02/09/iOS计算机视觉—ARKit/index.html">
<meta property="og:site_name" content="jacky&#39;s blog">
<meta property="og:description" content="ARKit介绍AR 全称 Augmented Reality(增强现实)是一种在视觉上呈现虚拟物体与现实场景结合的技术。Apple 公司在 2017 年 6 月正式推出了 ARKit，iOS 开发者可以在这个平台上使用简单便捷的 API 来开发 AR 应用程序。为了获得 ARKit 的完整功能，需要 A9 及以上芯片。其实也就是大部分运行 iOS 11 的设备，包括 iPhone 6S。  研究">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/301129-5cfc209057e8578b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/301129-c20b5a2654f3bbfd.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/301129-f6aa34b1cc2eb5f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/301129-7b89a99602a8dc06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/301129-c10224b013d1191d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/301129-210bdaf76b86ae4d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-bcc508f8024e31c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/608/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-f96f7e3dcd57426c.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/439/format/webp">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/301129-d58b92932077b8f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-425fdb57f5eda109.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/940/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-1d08b2ed43fa0349.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/334/format/webp">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/301129-f836671eab15757d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-ed60efa434274f9d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/990/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-03a48b53773b1885.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/532/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-d0b653f74d0c3c90.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/240/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-1843c18ffb035e61.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/240/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-a37ea7321a0ff717.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/878/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-131ab57c0037f3f4.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-273cd23a1a7fadb5.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-3deb05030f30e250.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-82f22cce5a45400d.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-b5d2ccb3e9f7a21e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-48f6ba8663eb2258.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-4ee1cc7269555514.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/385/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-d7be1503d7b87042.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/850/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/2249791-2204a21831e4411b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/910/format/webp">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/301129-bdd8c22856a81ede?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2019-02-09T07:58:39.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS计算机视觉—ARKit">
<meta name="twitter:description" content="ARKit介绍AR 全称 Augmented Reality(增强现实)是一种在视觉上呈现虚拟物体与现实场景结合的技术。Apple 公司在 2017 年 6 月正式推出了 ARKit，iOS 开发者可以在这个平台上使用简单便捷的 API 来开发 AR 应用程序。为了获得 ARKit 的完整功能，需要 A9 及以上芯片。其实也就是大部分运行 iOS 11 的设备，包括 iPhone 6S。  研究">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/301129-5cfc209057e8578b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jackyshan.github.io/2019/02/09/iOS计算机视觉—ARKit/"/>





  <title>iOS计算机视觉—ARKit | jacky's blog</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jacky's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">宁静致远</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jackyshan.github.io/2019/02/09/iOS计算机视觉—ARKit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jacky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jacky's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">iOS计算机视觉—ARKit</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-09T15:55:24+08:00">
                2019-02-09
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/09/iOS计算机视觉—ARKit/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/02/09/iOS计算机视觉—ARKit/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="https://upload-images.jianshu.io/upload_images/301129-5cfc209057e8578b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="ARKit介绍"><a href="#ARKit介绍" class="headerlink" title="ARKit介绍"></a>ARKit介绍</h3><p>AR 全称 Augmented Reality(增强现实)是一种在视觉上呈现虚拟物体与现实场景结合的技术。Apple 公司在 2017 年 6 月正式推出了 ARKit，iOS 开发者可以在这个平台上使用简单便捷的 API 来开发 AR 应用程序。为了获得 ARKit 的完整功能，需要 A9 及以上芯片。其实也就是大部分运行 iOS 11 的设备，包括 iPhone 6S。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/301129-c20b5a2654f3bbfd.gif?imageMogr2/auto-orient/strip" alt=""></p>
<p>研究过程中，做了一个卷尺的Demo，现在介绍下项目中用到的技术点。</p>
<h3 id="项目实践"><a href="#项目实践" class="headerlink" title="项目实践"></a>项目实践</h3><p>iOS 平台的 AR 应用通常由 ARKit 和渲染引擎两部分构成：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/301129-f6aa34b1cc2eb5f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<h4 id="ARKit"><a href="#ARKit" class="headerlink" title="ARKit"></a>ARKit</h4><p>ARKit 的 ARSession 负责管理每一帧的信息。ARSession 做了两件事：拍摄图像并获取传感器数据；对数据进行分析处理后逐帧输出。如下图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/301129-7b89a99602a8dc06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<h5 id="设备追踪"><a href="#设备追踪" class="headerlink" title="设备追踪"></a>设备追踪</h5><p>设备追踪确保了虚拟物体的位置不受设备移动的影响。在启动 ARSession 时需要传入一个 ARSessionConfiguration 的子类对象，以区别三种追踪模式：</p>
<ul>
<li>ARFaceTrackingConfiguration</li>
<li>ARWorldTrackingConfiguration</li>
<li>AROrientationTrackingConfiguration</li>
</ul>
<p>其中 ARFaceTrackingConfiguration 可以识别人脸的位置、方向以及获取拓扑结构。此外，还可以探测到预设的 52 种丰富的面部动作，如眨眼、微笑、皱眉等等。ARFaceTrackingConfiguration 需要调用支持 TrueDepth 的前置摄像头进行追踪。<br>本项目主要是使用ARWorldTrackingConfiguration进行追踪，获取特征点。</p>
<h6 id="追踪步骤"><a href="#追踪步骤" class="headerlink" title="追踪步骤"></a>追踪步骤</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// 创建一个 ARSessionConfiguration.</div><div class="line">// 暂时无需在意 ARWorldTrackingSessionConfiguration.</div><div class="line">let configuration = ARWorldTrackingSessionConfiguration()</div><div class="line">// Create a session.</div><div class="line">let session = ARSession()</div><div class="line">// Run.</div><div class="line">session.run(configuration)</div></pre></td></tr></table></figure>
<p>从上面的代码看，运行一个 ARSession 的过程是很简单的，那么 ARSession 的底层如何进行世界追踪的呢？</p>
<ul>
<li>首先，ARSession 底层使用了 AVCaputreSession 来获取摄像机拍摄的视频(一帧一帧的图像序列)。</li>
<li>其次，ARSession 底层使用了 CMMotionManager 来获取设备的运动信息(比如旋转角度、移动距离等)</li>
<li>最后，ARSession 根据获取的图像序列以及设备的运动信息进行分析，最后输出 ARFrame，ARFrame 中就包含有渲染虚拟世界所需的所有信息。</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/301129-c10224b013d1191d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"><br><img src="http://upload-images.jianshu.io/upload_images/301129-210bdaf76b86ae4d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<h6 id="追踪信息点"><a href="#追踪信息点" class="headerlink" title="追踪信息点"></a>追踪信息点</h6><p>AR-World 的坐标系如下，当我们运行 ARSession 时设备所在的位置就是 AR-World 的坐标系原点。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-bcc508f8024e31c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/608/format/webp" alt=""></p>
<p>在这个 AR-World 坐标系中，ARKit 会追踪以下几个信息：</p>
<ul>
<li>追踪设备的位置以及旋转，这里的两个信息均是相对于设备起始时的信息。</li>
<li>追踪物理距离(以“米”为单位)，例如 ARKit 检测到一个平面，我们希望知道这个平面有多大。</li>
<li>追踪我们手动添加的希望追踪的点，例如我们手动添加的一个虚拟物体。</li>
</ul>
<h6 id="追踪如何工作"><a href="#追踪如何工作" class="headerlink" title="追踪如何工作"></a>追踪如何工作</h6><p>苹果文档中对世界追踪过程是这么解释的：ARKit使用视觉惯性测距技术，对摄像头采集到的图像序列进行计算机视觉分析，并且与设备的运动传感器信息相结合。ARKit 会识别出每一帧图像中的特征点，并且根据特征点在连续的图像帧之间的位置变化，然后与运动传感器提供的信息进行比较，最终得到高精度的设备位置和偏转信息。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-f96f7e3dcd57426c.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/439/format/webp" alt=""></p>
<ul>
<li>上图中划出曲线的运动的点代表设备，可以看到以设备为中心有一个坐标系也在移动和旋转，这代表着设备在不断的移动和旋转。这个信息是通过设备的运动传感器获取的。</li>
<li>动图中右侧的黄色点是 3D 特征点。3D特征点就是处理捕捉到的图像得到的，能代表物体特征的点。例如地板的纹理、物体的边边角角都可以成为特征点。上图中我们看到当设备移动时，ARKit 在不断的追踪捕捉到的画面中的特征点。</li>
<li>ARKit 将上面两个信息进行结合，最终得到了高精度的设备位置和偏转信息。</li>
</ul>
<h6 id="ARWorldTrackingConfiguration"><a href="#ARWorldTrackingConfiguration" class="headerlink" title="ARWorldTrackingConfiguration"></a>ARWorldTrackingConfiguration</h6><p>ARWorldTrackingConfiguration 提供 6DoF（Six Degree of Freedom）的设备追踪。包括三个姿态角 Yaw（偏航角）、Pitch（俯仰角）和 Roll（翻滚角），以及沿笛卡尔坐标系中 X、Y 和 Z 三轴的偏移量：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/301129-d58b92932077b8f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>不仅如此，ARKit 还使用了 VIO（Visual-Inertial Odometry）来提高设备运动追踪的精度。在使用惯性测量单元(IMU)检测运动轨迹的同时，对运动过程中摄像头拍摄到的图片进行图像处理。将图像中的一些特征点的变化轨迹与传感器的结果进行比对后，输出最终的高精度结果。<br>从追踪的维度和准确度来看，ARWorldTrackingConfiguration 非常强悍。但如官方文档所言，它也有两个致命的缺点：</p>
<ul>
<li>受环境光线质量影响</li>
<li>受剧烈运动影响</li>
</ul>
<p>由于在追踪过程中要通过采集图像来提取特征点，所以图像的质量会影响追踪的结果。在光线较差的环境下（比如夜晚或者强光），拍摄的图像无法提供正确的参考，追踪的质量也会随之下降。</p>
<p>追踪过程中会逐帧比对图像与传感器结果，如果设备在短时间内剧烈的移动，会很大程度上干扰追踪结果。</p>
<h6 id="追踪状态"><a href="#追踪状态" class="headerlink" title="追踪状态"></a>追踪状态</h6><p>世界追踪有三种状态，我们可以通过 camera.trackingState 获取当前的追踪状态。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-425fdb57f5eda109.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/940/format/webp" alt=""></p>
<p>从上图我们看到有三种追踪状态：</p>
<ul>
<li>Not Available：世界追踪正在初始化，还未开始工作。</li>
<li>Normal： 正常工作状态。</li>
<li>Limited：限制状态，当追踪质量受到影响时，追踪状态可能会变为 Limited 状态。</li>
</ul>
<p>与 TrackingState 关联的一个信息是 ARCamera.TrackingState.Reason，这是一个枚举类型：</p>
<ul>
<li>case excessiveMotion：设备移动过快，无法正常追踪。</li>
<li>case initializing：正在初始化。</li>
<li>case insufficientFeatures：特征过少，无法正常追踪。</li>
<li>case none：正常工作。</li>
</ul>
<p>我们可以通过 ARSessionObserver 协议去获取追踪状态的变化，比较简单，可以直接查看接口文档。</p>
<h5 id="ARFrame"><a href="#ARFrame" class="headerlink" title="ARFrame"></a>ARFrame</h5><p>ARFrame 中包含有世界追踪过程获取的所有信息，ARFrame 中与世界追踪有关的信息主要是：anchors 和 camera：</p>
<ul>
<li>camera: 含有摄像机的位置、旋转以及拍照参数等信息。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var camera: [ARCamera]</div></pre></td></tr></table></figure>
<ul>
<li>ahchors: 代表了追踪的点或面。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var anchors: [ARAnchor]</div></pre></td></tr></table></figure>
<h6 id="ARAnchor"><a href="#ARAnchor" class="headerlink" title="ARAnchor"></a>ARAnchor</h6><p><img src="https://upload-images.jianshu.io/upload_images/2249791-1d08b2ed43fa0349.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/334/format/webp" alt=""></p>
<ul>
<li>ARAnchor 是空间中相对真实世界的位置和角度。</li>
<li>ARAnchor 可以添加到场景中，或是从场景中移除。基本上来说，它们用于表示虚拟内容在物理环境中的锚定。所以如果要添加自定义 anchor，添加到 session 里就可以了。它会在 session 生命周期中一直存在。但如果你在运行诸如平面检测功能，ARAnchor 则会被自动添加到 session 中。</li>
<li>要响应被添加的 anchor，可以从 current ARFrame 中获得完整列表，此列表包含 session 正在追踪的所有 anchor。</li>
<li>或者也可以响应 delegate 方法，例如 add、update 以及 remove，session 中的 anchor 被添加、更新或移除时会通知。</li>
</ul>
<h6 id="ARCamera"><a href="#ARCamera" class="headerlink" title="ARCamera"></a>ARCamera</h6><p><img src="http://upload-images.jianshu.io/upload_images/301129-f836671eab15757d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>每个 ARFrame 都会包含一个 ARCamera。ARCamera 对象表示虚拟摄像头。虚拟摄像头就代表了设备的角度和位置。</p>
<ul>
<li>ARCamera 提供了一个 transform。transform 是一个 4x4 矩阵。提供了物理设备相对于初始位置的变换。</li>
<li>ARCamera 提供了追踪状态（tracking state），通知你如何使用 transform，这个在后面会讲。</li>
<li>ARCamera 提供了相机内部功能（camera intrinsics）。包括焦距和主焦点，用于寻找投影矩阵。投影矩阵是 ARCamera 上的一个 convenience 方法，可用于渲染虚拟你的几何体。</li>
</ul>
<h5 id="场景解析"><a href="#场景解析" class="headerlink" title="场景解析"></a>场景解析</h5><p><img src="https://upload-images.jianshu.io/upload_images/2249791-ed60efa434274f9d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/990/format/webp" alt=""></p>
<p>场景解析主要功能是对现实世界的场景进行分析，解析出比如现实世界的平面等信息，可以让我们把一些虚拟物体放在某些实物处。ARKit 提供的场景解析主要有平面检测、场景交互以及光照估计三种，下面逐个分析。</p>
<h6 id="平面检测-Plane-detection"><a href="#平面检测-Plane-detection" class="headerlink" title="平面检测(Plane detection)"></a>平面检测(Plane detection)</h6><ul>
<li>ARKit 的平面检测用于检测出现实世界的水平面。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-03a48b53773b1885.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/532/format/webp" alt=""></p>
<p>上图中可以看出，ARkit 检测出了两个平面，图中的两个三维坐标系是检测出的平面的本地坐标系，此外，检测出的平面是有一个大小范围的。</p>
<ul>
<li>平面检测是一个动态的过程，当摄像机不断移动时，检测到的平面也会不断的变化。下图中可以看到当移动摄像机时，已经检测到的平面的坐标原点以及平面范围都在不断的变化。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-d0b653f74d0c3c90.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/240/format/webp" alt=""></p>
<ul>
<li>此外，随着平面的动态检测，不同平面也可能会合并为一个新的平面。下图中可以看到已经检测到的平面随着摄像机移动合并为了一个平面。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-1843c18ffb035e61.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/240/format/webp" alt=""></p>
<ul>
<li>开启平面检测</li>
</ul>
<p>开启平面检测很简单，只需要在 run ARSession 之前，将 ARSessionConfiguration 的 planeDetection 属性设为 true 即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// Create a world tracking session configuration.</div><div class="line">let configuration = ARWorldTrackingSessionConfiguration()</div><div class="line">configuration.planeDetection = .horizontal</div><div class="line">// Create a session.</div><div class="line">let session = ARSession()</div><div class="line">// Run.</div><div class="line">session.run(configuration)</div></pre></td></tr></table></figure>
<ul>
<li>平面的表示方式</li>
</ul>
<p>当 ARKit 检测到一个平面时，ARKit 会为该平面自动添加一个 ARPlaneAnchor，这个 ARPlaneAnchor 就表示了一个平面。</p>
<ul>
<li>当 ARKit 系统检测到新平面时，ARKit 会自动添加一个 ARPlaneAnchor 到 ARSession 中。我们可以通过 ARSessionDelegate 获取当前 ARSession 的 ARAnchor 改变的通知，主要有以下三种情况：</li>
</ul>
<p>新加入了 ARAnchor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">func session(_ session: ARSession, didAdd anchors: [ARAnchor])</div></pre></td></tr></table></figure>
<p>对于平面检测来说，当新检测到某平面时，我们会收到该通知，通知中的 ARAnchor 数组会包含新添加的平面，其类型是 ARPlaneAnchor，我们可以像下面这样使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">func session(_ session: ARSession, didAdd anchors: [ARAnchor]) &#123;</div><div class="line">    for anchor in anchors &#123;</div><div class="line">        if let anchor = anchor as? ARPlaneAnchor &#123;</div><div class="line">            print(anchor.center)</div><div class="line">            print(anchor.extent)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ARAnchor 更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">func session(_ session: ARSession, didUpdate anchors: [ARAnchor])</div></pre></td></tr></table></figure>
<p>从上面我们知道当设备移动时，检测到的平面是不断更新的，当平面更新时，会回调这个接口。</p>
<p>删除 ARAnchor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">func session(_ session: ARSession, didRemove anchors: [ARAnchor])</div></pre></td></tr></table></figure>
<p>当手动删除某个 Anchor 时，会回调此方法。此外，对于检测到的平面来说，如果两个平面进行了合并，则会删除其中一个，此时也会回调此方法。</p>
<h6 id="场景交互-Hit-testing"><a href="#场景交互-Hit-testing" class="headerlink" title="场景交互(Hit-testing)"></a>场景交互(Hit-testing)</h6><p>Hit-testing 是为了获取当前捕捉到的图像中某点击位置有关的信息(包括平面、特征点、ARAnchor 等)。</p>
<p>原理图如下</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-a37ea7321a0ff717.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/878/format/webp" alt=""></p>
<p>当点击屏幕时，ARKit 会发射一个射线，假设屏幕平面是三维坐标系中的 xy 平面，那么该射线会沿着 z 轴方向射向屏幕里面，这就是一次 Hit-testing 过程。此次过程会将射线遇到的所有有用信息返回，返回结果以离屏幕距离进行排序，离屏幕最近的排在最前面。</p>
<p>ARFrame 提供了 Hit-testing 的接口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">func hitTest(_ point: CGPoint, types: ARHitTestResult.ResultType) -&gt; [ARHitTestResult]</div></pre></td></tr></table></figure>
<p>上述接口中有一个 types 参数，该参数表示此次 Hit-testing 过程需要获取的信息类型。ResultType 有以下四种：</p>
<ul>
<li>featurePoint</li>
</ul>
<p>表示此次 Hit-testing 过程希望返回当前图像中 Hit-testing 射线经过的 3D 特征点。如下图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-131ab57c0037f3f4.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp" alt=""></p>
<ul>
<li>estimatedHorizontalPlane</li>
</ul>
<p>表示此次 Hit-testing 过程希望返回当前图像中 Hit-testing 射线经过的预估平面。预估平面表示 ARKit 当前检测到一个可能是平面的信息，但当前尚未确定是平面，所以 ARKit 还没有为此预估平面添加 ARPlaneAnchor。如下图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-273cd23a1a7fadb5.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp" alt=""></p>
<ul>
<li>existingPlaneUsingExtent</li>
</ul>
<p>表示此次 Hit-testing 过程希望返回当前图像中 Hit-testing 射线经过的有大小范围的平面。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-3deb05030f30e250.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp" alt=""></p>
<p>上图中，如果 Hit-testing 射线经过了有大小范围的绿色平面，则会返回此平面，如果射线落在了绿色平面的外面，则不会返回此平面。</p>
<ul>
<li>existingPlane</li>
</ul>
<p>表示此次 Hit-testing 过程希望返回当前图像中 Hit-testing 射线经过的无限大小的平面。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-82f22cce5a45400d.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/500/format/webp" alt=""></p>
<p>上图中，平面大小是绿色平面所展示的大小，但 exsitingPlane 选项表示即使 Hit-testing 射线落在了绿色平面外面，也会将此平面返回。换句话说，将所有平面无限延展，只要 Hit-testing 射线经过了无限延展后的平面，就会返回该平面。</p>
<p>示例代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// Adding an ARAnchor based on hit-test</div><div class="line">let point = CGPoint(x: 0.5, y: 0.5)  // Image center</div><div class="line"></div><div class="line">// Perform hit-test on frame.</div><div class="line">let results = frame. hitTest(point, types: [.featurePoint, .estimatedHorizontalPlane])</div><div class="line"></div><div class="line">// Use the first result.</div><div class="line">if let closestResult = results.first &#123;</div><div class="line">    // Create an anchor for it.</div><div class="line">    anchor = ARAnchor(transform: closestResult.worldTransform)</div><div class="line">    // Add it to the session.</div><div class="line">    session.add(anchor: anchor)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码中，Hit-testing 的 point(0.5, 0.5)代表屏幕的中心，屏幕左上角为(0, 0)，右下角为(1, 1)。 对于 featurePoint 和 estimatedHorizontalPlane 的结果，ARKit 没有为其添加 ARAnchor，我们可以使用 Hit-testing 获取信息后自己为 ARSession 添加 ARAnchor，上面代码就显示了此过程。</p>
<h6 id="光照估计-Light-estimation"><a href="#光照估计-Light-estimation" class="headerlink" title="光照估计(Light estimation)"></a>光照估计(Light estimation)</h6><p><img src="https://upload-images.jianshu.io/upload_images/2249791-b5d2ccb3e9f7a21e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt=""></p>
<p>上图中，一个虚拟物体茶杯被放在了现实世界的桌子上。</p>
<p>当周围环境光线较好时，摄像机捕捉到的图像光照强度也较好，此时，我们放在桌子上的茶杯看起来就比较贴近于现实效果，如上图最左边的图。但是当周围光线较暗时，摄像机捕捉到的图像也较暗，如上图中间的图，此时茶杯的亮度就显得跟现实世界格格不入。</p>
<p>针对这种情况，ARKit 提供了光照估计，开启光照估计后，我们可以拿到当前图像的光照强度，从而能够以更自然的光照强度去渲染虚拟物体，如上图最右边的图。</p>
<p>光照估计基于当前捕捉到的图像的曝光等信息，给出一个估计的光照强度值(单位为 lumen，光强单位)。默认的光照强度为 1000lumen，当现实世界较亮时，我们可以拿到一个高于 1000lumen 的值，相反，当现实世界光照较暗时，我们会拿到一个低于 1000lumen 的值。</p>
<p>ARKit 的光照估计默认是开启的，当然也可以通过下述方式手动配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">configuration.isLightEstimationEnabled = true</div></pre></td></tr></table></figure>
<p>获取光照估计的光照强度也很简单，只需要拿到当前的 ARFrame，通过以下代码即可获取估计的光照强度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let intensity = frame.lightEstimate?.ambientIntensity</div></pre></td></tr></table></figure>
<h4 id="SceneKit"><a href="#SceneKit" class="headerlink" title="SceneKit"></a>SceneKit</h4><p><img src="https://upload-images.jianshu.io/upload_images/2249791-48f6ba8663eb2258.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt=""></p>
<p>渲染是呈现 AR world 的最后一个过程。此过程将创建的虚拟世界、捕捉的真实世界、ARKit 追踪的信息以及 ARKit 场景解析的的信息结合在一起，渲染出一个 AR world。渲染过程需要实现以下几点才能渲染出正确的 AR world：</p>
<ul>
<li>将摄像机捕捉到的真实世界的视频作为背景。</li>
<li>将世界追踪到的相机状态信息实时更新到 AR world 中的相机。</li>
<li>处理光照估计的光照强度。</li>
<li>实时渲染虚拟世界物体在屏幕中的位置。</li>
</ul>
<p>如果我们自己处理这个过程，可以看到还是比较复杂的，ARKit 为简化开发者的渲染过程，为开发者提供了简单易用的使用 SceneKit(3D 引擎)以及 SpriteKit(2D 引擎)渲染的视图ARSCNView以及ARSKView。当然开发者也可以使用其他引擎进行渲染，只需要将以上几个信息进行处理融合即可。</p>
<h5 id="SceneKit-的坐标系"><a href="#SceneKit-的坐标系" class="headerlink" title="SceneKit 的坐标系"></a>SceneKit 的坐标系</h5><p>我们知道 UIKit 使用一个包含有 x 和 y 信息的 CGPoint 来表示一个点的位置，但是在 3D 系统中，需要一个 z 参数来描述物体在空间中的深度，SceneKit 的坐标系可以参考下图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-4ee1cc7269555514.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/385/format/webp" alt=""></p>
<p>这个三维坐标系中，表示一个点的位置需要使用(x,y,z)坐标表示。红色方块位于 x 轴，绿色方块位于 y 轴，蓝色方块位于 z 轴，灰色方块位于原点。在 SceneKit 中我们可以这样创建一个三维坐标：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">let position = SCNVector3(x: 0, y: 5, z: 10)</div></pre></td></tr></table></figure>
<h5 id="SceneKit-中的场景和节点"><a href="#SceneKit-中的场景和节点" class="headerlink" title="SceneKit 中的场景和节点"></a>SceneKit 中的场景和节点</h5><p>我们可以将 SceneKit 中的场景(SCNScene)想象为一个虚拟的 3D 空间，然后可以将一个个的节点(SCNNode)添加到场景中。SCNScene 中有唯一一个根节点(坐标是(x:0, y:0, z:0))，除了根节点外，所有添加到 SCNScene 中的节点都需要一个父节点。</p>
<p>下图中位于坐标系中心的就是根节点，此外还有添加的两个节点 NodeA 和 NodeB，其中 NodeA 的父节点是根节点，NodeB 的父节点是 NodeA：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-d7be1503d7b87042.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/850/format/webp" alt=""></p>
<p>SCNScene 中的节点加入时可以指定一个三维坐标(默认为(x:0, y:0, z:0))，这个坐标是相对于其父节点的位置。这里说明两个概念：</p>
<ul>
<li>本地坐标系：以场景中的某节点(非根节点)为原点建立的三维坐标系</li>
<li>世界坐标系：以根节点为原点创建的三维坐标系称为世界坐标系。</li>
</ul>
<p>上图中我们可以看到 NodeA 的坐标是相对于世界坐标系(由于 NodeA 的父节点是根节点)的位置，而 NodeB 的坐标代表了 NodeB 在 NodeA 的本地坐标系位置(NodeB 的父节点是 NodeA)。</p>
<h5 id="SceneKit-中的摄像机"><a href="#SceneKit-中的摄像机" class="headerlink" title="SceneKit 中的摄像机"></a>SceneKit 中的摄像机</h5><p>有了 SCNScene 和 SCNNode 后，我们还需要一个摄像机(SCNCamera)来决定我们可以看到场景中的哪一块区域(就好比现实世界中有了各种物体，但还需要人的眼睛才能看到物体)。摄像机在 SCNScene 的工作模式如下图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2249791-2204a21831e4411b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/910/format/webp" alt=""></p>
<p>上图中包含以下几点信息：</p>
<ul>
<li>SceneKit 中 SCNCamera 拍摄的方向始终为 z 轴负方向。</li>
<li>视野(Field of View)是摄像机的可视区域的极限角度。角度越小，视野越窄，反之，角度越大，视野越宽。</li>
<li>视锥体(Viewing Frustum)决定着摄像头可视区域的深度(z 轴表示深度)。任何不在这个区域内的物体将被剪裁掉(离摄像头太近或者太远)，不会显示在最终的画面中。</li>
</ul>
<p>在 SceneKit 中我们可以使用如下方式创建一个摄像机：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">let scene = SCNScene()</div><div class="line">let cameraNode = SCNNode()</div><div class="line">let camera = SCNCamera()</div><div class="line">cameraNode.camera = camera</div><div class="line">cameraNode.position = SCNVector3(x: 0, y: 0, z: 0)</div><div class="line">scene.rootNode.addChildNode(cameraNode)</div></pre></td></tr></table></figure>
<h5 id="SCNView"><a href="#SCNView" class="headerlink" title="SCNView"></a>SCNView</h5><p>最后，我们需要一个 View 来将 SCNScene 中的内容渲染到显示屏幕上，这个工作由 SCNView 完成。这一步其实很简单，只需要创建一个 SCNView 实例，然后将 SCNView 的 scene 属性设置为刚刚创建的 SCNScene，然后将 SCNView 添加到 UIKit 的 view 或 window 上即可。示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">let scnView = SCNView()</div><div class="line">scnView.scene = scene</div><div class="line">vc.view.addSubview(scnView)</div><div class="line">scnView.frame = vc.view.bounds</div></pre></td></tr></table></figure>
<h3 id="关注我"><a href="#关注我" class="headerlink" title="关注我"></a>关注我</h3><p>欢迎关注公众号：jackyshan，技术干货首发微信，第一时间推送。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/301129-bdd8c22856a81ede?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ios/" rel="tag"># ios</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/19/iOS中对瀑布流实现适配器方案/" rel="next" title="iOS中对瀑布流实现适配器方案">
                <i class="fa fa-chevron-left"></i> iOS中对瀑布流实现适配器方案
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/02/09/组件化之路—集成组件SDK/" rel="prev" title="组件化之路—集成组件SDK">
                组件化之路—集成组件SDK <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="jacky" />
          <p class="site-author-name" itemprop="name">jacky</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">51</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/a2133b6aa395" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  简书
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://juejin.im/user/5a7c14cb6fb9a0635d0c0c4f/posts" target="_blank" title="掘金">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  掘金
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/jackyshan" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#ARKit介绍"><span class="nav-number">1.</span> <span class="nav-text">ARKit介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#项目实践"><span class="nav-number">2.</span> <span class="nav-text">项目实践</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ARKit"><span class="nav-number">2.1.</span> <span class="nav-text">ARKit</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#设备追踪"><span class="nav-number">2.1.1.</span> <span class="nav-text">设备追踪</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#追踪步骤"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">追踪步骤</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#追踪信息点"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">追踪信息点</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#追踪如何工作"><span class="nav-number">2.1.1.3.</span> <span class="nav-text">追踪如何工作</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#ARWorldTrackingConfiguration"><span class="nav-number">2.1.1.4.</span> <span class="nav-text">ARWorldTrackingConfiguration</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#追踪状态"><span class="nav-number">2.1.1.5.</span> <span class="nav-text">追踪状态</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ARFrame"><span class="nav-number">2.1.2.</span> <span class="nav-text">ARFrame</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#ARAnchor"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">ARAnchor</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#ARCamera"><span class="nav-number">2.1.2.2.</span> <span class="nav-text">ARCamera</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#场景解析"><span class="nav-number">2.1.3.</span> <span class="nav-text">场景解析</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#平面检测-Plane-detection"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">平面检测(Plane detection)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#场景交互-Hit-testing"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">场景交互(Hit-testing)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#光照估计-Light-estimation"><span class="nav-number">2.1.3.3.</span> <span class="nav-text">光照估计(Light estimation)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SceneKit"><span class="nav-number">2.2.</span> <span class="nav-text">SceneKit</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SceneKit-的坐标系"><span class="nav-number">2.2.1.</span> <span class="nav-text">SceneKit 的坐标系</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SceneKit-中的场景和节点"><span class="nav-number">2.2.2.</span> <span class="nav-text">SceneKit 中的场景和节点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SceneKit-中的摄像机"><span class="nav-number">2.2.3.</span> <span class="nav-text">SceneKit 中的摄像机</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SCNView"><span class="nav-number">2.2.4.</span> <span class="nav-text">SCNView</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关注我"><span class="nav-number">3.</span> <span class="nav-text">关注我</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jacky</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://jackyshan.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://jackyshan.github.io/2019/02/09/iOS计算机视觉—ARKit/';
          this.page.identifier = '2019/02/09/iOS计算机视觉—ARKit/';
          this.page.title = 'iOS计算机视觉—ARKit';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://jackyshan.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
